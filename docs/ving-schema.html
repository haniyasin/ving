<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ving-schema.md</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css">
    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/themes/primeone-light.css">
        <style type="text/css">
        html {
            font-size: 1rem;
            height: 100%;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--bg-white);
            color: var(--text-color);
            padding: 0;
            margin: 0;
            min-height: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        li a {
            text-decoration: none;
        }
       ol,ul {
            list-style: none;
            margin-left: 0;
            padding-left: 10px;
        }
    </style>
</head>

<body>
    <div class="grid">
        <div class="col-3 lg:col-2 p-3 surface-300">
            <div class="sticky top-0 left-0">
                <div class="text-4xl">Ving Docs</div>
                <p>Basics</p>
<ul>
<li><a href="about.html">About</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="error-codes.html">Error Codes</a></li>
<li><a href="change-log.html">Change Log</a></li>
</ul>
<p>Subsystems</p>
<ul>
<li><a href="cache.html">Cache</a></li>
<li><a href="cli.html">CLI</a></li>
<li><a href="drizzle.html">Database</a></li>
<li><a href="email.html">Email</a></li>
<li><a href="ving-record.html">Ving Record</a></li>
<li><a href="ving-schema.html">Ving Schema</a></li>
<li><a href="rest.html">Rest</a></li>
<li><a href="ui.html">UI</a></li>
</ul>
<p>Rest APIs</p>
<ul>
<li><a href="apikey.html">API Key</a></li>
<li><a href="session.html">Session</a></li>
<li><a href="test.html">Test</a></li>
<li><a href="user.html">User</a></li>
</ul>

            </div>
        </div>
            <div class="col lg:col-3 p-3 surface-200"><div class="sticky top-0 right-0"> 
<nav class="table-of-contents"><ol><li><a href="#ving-schema">Ving Schema </a><ol><li><a href="#creating-a-new-schema">Creating a New Schema </a></li><li><a href="#attributes">Attributes </a><ol><li><a href="#kind">kind </a></li><li><a href="#tablename">tableName </a></li><li><a href="#owner">owner </a></li><li><a href="#props">props </a><ol><li><a href="#prop-privileges">Prop Privileges </a></li><li><a href="#prop-types">Prop Types </a><ol><li><a href="#boolean-props">Boolean Props </a></li><li><a href="#date-props">Date Props </a></li><li><a href="#enum-props">Enum Props </a></li><li><a href="#id-props">Id Props </a></li><li><a href="#string-props">String Props </a></li><li><a href="#virtual-props">Virtual Props </a></li></ol></li></ol></li></ol></li><li><a href="#generate-drizzle-tables-from-ving-schema">Generate Drizzle Tables from Ving Schema </a></li></ol></li></ol></nav></div></div><div class="col min-h-screen"> 
<h1 id="ving-schema" tabindex="-1">Ving Schema <a class="header-anchor" href="#ving-schema">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h1>
<p>You’ll find the schemas in <code>server/vingschema/schemas</code>. A schema looks like this:</p>
<pre><code class="language-js">{
    kind: 'User',
    tableName: 'users',
    owner: ['$id', 'admin'],
    props: [
        ...baseSchemaProps,
        {
            type: &quot;string&quot;,
            name: &quot;username&quot;,
            required: true,
            unique: true,
            length: 60,
            default: '',
            db: (prop) =&gt; dbString(prop),
            zod: (prop) =&gt; zodString(prop),
            view: [],
            edit: ['owner'],
        },
    ],
}
</code></pre>
<h2 id="creating-a-new-schema" tabindex="-1">Creating a New Schema <a class="header-anchor" href="#creating-a-new-schema">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h2>
<p>Use the <a href="cli.html">CLI</a> to generate a new schema skeleton to work from.</p>
<pre><code class="language-bash">./ving.mjs --new=Foo
</code></pre>
<h2 id="attributes" tabindex="-1">Attributes <a class="header-anchor" href="#attributes">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h2>
<h3 id="kind" tabindex="-1">kind <a class="header-anchor" href="#kind">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h3>
<p>A string that represents the unique name of the schema and everything generated from it.</p>
<h3 id="tablename" tabindex="-1">tableName <a class="header-anchor" href="#tablename">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h3>
<p>A string that is name of the MySQL database table it will be stored in.</p>
<h3 id="owner" tabindex="-1">owner <a class="header-anchor" href="#owner">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h3>
<p>An array containing the method for determining who owns this object. Owners can be assigned special rights on <code>props</code>. The owner can be any field that contains a User ID, so in the case of the <code>User</code> schema, it can use its own id by specifying <code>$id</code>, but in another table it might be <code>$userId</code>. It can also contain any number of roles. By default there are two roles: <code>admin</code> and <code>developer</code>, but you could add more.</p>
<h3 id="props" tabindex="-1">props <a class="header-anchor" href="#props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h3>
<p>All schemas should have the base props of <code>id</code>, <code>createdAt</code>, and <code>updatedAt</code> by using <code>...baseSchemaProps</code>. After that it’s up to you to add your own props to the list. There are many different types of props for different field types.</p>
<p>Props all have the fields <code>type</code>, <code>name</code>, <code>required</code>, <code>default</code>, <code>db</code>, <code>zod</code>, <code>view</code>, and <code>edit</code>, but can have more or less fields from there.</p>
<h4 id="prop-privileges" tabindex="-1">Prop Privileges <a class="header-anchor" href="#prop-privileges">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h4>
<p>The <code>view</code> and <code>edit</code> props are arrays that can:</p>
<ul>
<li>Be empty, if no one should be able to view or edit that prop</li>
<li>Contain the special keyword <code>public</code>, if everyone should be able to view or edit that prop</li>
<li>Contain any role (such as <code>admin</code>)</li>
<li>Contain the special keyword <code>owner</code>, so that whoever was defined as the owner in the attributes of the schema can view or edit that prop</li>
</ul>
<p>If a role can <code>edit</code> a prop it can automatically <code>view</code> a prop.</p>
<blockquote>
<p>Roles can be defined inside the <code>User</code> schema. They have to be added as a <a href="boolean-props">boolean prop type</a>, and then also added to the <code>RoleOptions</code> at the bottom of the file.</p>
</blockquote>
<h4 id="prop-types" tabindex="-1">Prop Types <a class="header-anchor" href="#prop-types">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h4>
<h5 id="boolean-props" tabindex="-1">Boolean Props <a class="header-anchor" href="#boolean-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<pre><code class="language-js">{
    type: &quot;boolean&quot;,
    name: 'admin',
    required: true,
    default: false,
    db: (prop) =&gt; dbBoolean(prop),
    enums: [false, true],
    enumLabels: ['Not Admin', 'Admin'],
    view: ['owner'],
    edit: ['admin'],
},
</code></pre>
<h5 id="date-props" tabindex="-1">Date Props <a class="header-anchor" href="#date-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<pre><code class="language-js">{
    type: &quot;date&quot;,
    name: &quot;startAt&quot;,
    required: true,
    autoUpdate: true,
    default: () =&gt; new Date(),
    db: (prop) =&gt; dbDateTime(prop),
    view: ['public'],
    edit: [],
},
</code></pre>
<h5 id="enum-props" tabindex="-1">Enum Props <a class="header-anchor" href="#enum-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<pre><code class="language-js">{
    type: &quot;enum&quot;,
    name: 'useAsDisplayName',
    required: true,
    length: 20,
    default: 'username',
    db: (prop) =&gt; dbEnum(prop),
    enums: ['username', 'email', 'realName'],
    enumLabels: ['Username', 'Email Address', 'Real Name'],
    view: [],
    edit: ['owner'],
},
</code></pre>
<h5 id="id-props" tabindex="-1">Id Props <a class="header-anchor" href="#id-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<p>These are used to add a parent relationship.</p>
<pre><code class="language-js">{
    type: &quot;id&quot;,
    name: 'userId',
    required: true,
    length: 36,
    db: (prop) =&gt; dbRelation(prop),
    relation: {
        type: 'parent',
        name: 'user',
        kind: 'User',
    },
    default: undefined,
    view: ['public'],
    edit: ['owner'],
},
</code></pre>
<h5 id="string-props" tabindex="-1">String Props <a class="header-anchor" href="#string-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<pre><code class="language-js">{
    type: &quot;string&quot;,
    name: &quot;email&quot;,
    required: true,
    unique: true,
    length: 256,
    default: '',
    db: (prop) =&gt; dbString(prop),
    zod: (prop) =&gt; zodString(prop).email(),
    view: [],
    edit: ['owner'],
},

</code></pre>
<h5 id="virtual-props" tabindex="-1">Virtual Props <a class="header-anchor" href="#virtual-props">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h5>
<p>These are used to add a child relationship.</p>
<pre><code class="language-js">{
    type: &quot;virtual&quot;,
    name: 'apikeys',
    required: false,
    view: ['public'],
    edit: [],
    relation: {
        type: 'child',
        name: 'apikeys',
        kind: 'APIKey',
    },
},
</code></pre>
<h2 id="generate-drizzle-tables-from-ving-schema" tabindex="-1">Generate Drizzle Tables from Ving Schema <a class="header-anchor" href="#generate-drizzle-tables-from-ving-schema">
          <span aria-hidden="true" class="hidden">#</span>
        </a></h2>
<p>Now that you’ve created or updated your schema, you can generate <a href="drizzle.html">Drizzle</a> tables from  with this command:</p>
<pre><code class="language-bash">./ving.mjs schema --makeTables
</code></pre>
<blockquote>
<p>Note that you shouldn’t ever need to modify these files directly. If you need to change them, update the ving schema and run the above command again.</p>
</blockquote>
</div>
    </div>
    
</body>

</html>